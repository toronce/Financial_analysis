<!-- ê²€ìƒ‰ ì…ë ¥ -->
            <div class="max-w-md mx-auto mb-8">
                <div class="relative">
                    <input type="text" id="companySearch" placeholder="ì˜ˆ: ì‚¼ì„±ì „ì, 005930.KS, Apple, AAPL" 
                           class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           onkeypress="handleSearchKeyPress(event)" oninput="handleSearchInput(event)" autocomplete="off">
                    <button onclick="searchCompany()" 
                            class="absolute right-2 top-2 px-4 py-<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>ìë™ ì¬ë¬´ì œí‘œ ë¶„ì„ê¸°</title>
    
    <!-- CSS ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- JavaScript ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <style>
        .hidden { display: none !important; }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .ratio-card {
            transition: all 0.3s ease;
        }
        .ratio-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .search-result {
            transition: all 0.2s ease;
        }
        .search-result:hover {
            background-color: #f3f4f6;
        }
        
        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 768px) {
            .grid-cols-3 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
            .text-3xl { font-size: 1.5rem; }
            .p-8 { padding: 1rem; }
        }
        
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto p-4 max-w-7xl">
        <!-- í—¤ë” -->
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">
                <i class="fas fa-robot text-blue-600 mr-2"></i>
                ìë™ ì¬ë¬´ì œí‘œ ë¶„ì„ê¸°
            </h1>
            <p class="text-gray-600">ê¸°ì—…ëª…ë§Œ ì…ë ¥í•˜ë©´ ì‹¤ì‹œê°„ ì¬ë¬´ì œí‘œë¥¼ ìë™ìœ¼ë¡œ ë¶„ì„í•´ë“œë ¤ìš”!</p>
            <div class="mt-2 text-sm text-gray-500">
                ğŸ¤– Yahoo Finance API | ğŸŒ ì „ì„¸ê³„ ê¸°ì—… ì§€ì› | ğŸ“Š ì‹¤ì‹œê°„ ë¶„ì„
            </div>
        </header>

        <!-- íƒ­ ë©”ë‰´ -->
        <div class="flex flex-wrap bg-white rounded-lg shadow-md mb-6 overflow-hidden">
            <button onclick="showTab('search')" id="tab-search" 
                    class="flex-1 min-w-0 py-3 px-4 text-sm font-medium bg-blue-600 text-white border-r border-gray-200 transition-colors">
                <i class="fas fa-search mr-1"></i>
                <span class="hidden sm:inline">ê¸°ì—… </span>ê²€ìƒ‰
            </button>
            <button onclick="showTab('upload')" id="tab-upload" 
                    class="flex-1 min-w-0 py-3 px-4 text-sm font-medium text-gray-600 hover:bg-gray-50 border-r border-gray-200 transition-colors">
                <i class="fas fa-upload mr-1"></i>
                <span class="hidden sm:inline">íŒŒì¼ </span>ì—…ë¡œë“œ
            </button>
            <button onclick="showTab('analysis')" id="tab-analysis" 
                    class="flex-1 min-w-0 py-3 px-4 text-sm font-medium text-gray-600 hover:bg-gray-50 border-r border-gray-200 transition-colors">
                <i class="fas fa-calculator mr-1"></i>
                <span class="hidden sm:inline">ì¬ë¬´ </span>ë¶„ì„
            </button>
            <button onclick="showTab('charts')" id="tab-charts" 
                    class="flex-1 min-w-0 py-3 px-4 text-sm font-medium text-gray-600 hover:bg-gray-50 transition-colors">
                <i class="fas fa-chart-bar mr-1"></i>
                <span class="hidden sm:inline">ì°¨íŠ¸ </span>ë¶„ì„
            </button>
        </div>

        <!-- ê¸°ì—… ê²€ìƒ‰ íƒ­ -->
        <div id="content-search" class="bg-white rounded-lg shadow-lg p-8">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">ğŸ”</div>
                <h3 class="text-xl font-semibold mb-2">ê¸°ì—… ê²€ìƒ‰ & ìë™ ë¶„ì„</h3>
                <p class="text-gray-600 mb-6">ê¸°ì—…ëª…ì´ë‚˜ í‹°ì»¤ ì‹¬ë³¼ì„ ì…ë ¥í•˜ë©´ ì‹¤ì‹œê°„ ì¬ë¬´ì œí‘œë¥¼ ê°€ì ¸ì™€ì„œ ë¶„ì„í•´ë“œë ¤ìš”</p>
            </div>

            <!-- ê²€ìƒ‰ ì…ë ¥ -->
            <div class="max-w-md mx-auto mb-8">
                <div class="relative">
                    <input type="text" id="companySearch" placeholder="ì˜ˆ: ì‚¼ì„±ì „ì, 005930.KS, Apple, AAPL" 
                           class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           onkeypress="handleSearchKeyPress(event)">
                    <button onclick="searchCompany()" 
                            class="absolute right-2 top-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>

            <!-- ì¸ê¸° ê¸°ì—… -->
            <div class="mb-8">
                <h4 class="text-lg font-semibold mb-4 text-center">âš¡ ë¹ ë¥¸ ë¶„ì„</h4>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 max-w-2xl mx-auto">
                    <button onclick="selectAndAnalyze('005930.KS')" class="p-3 bg-blue-100 hover:bg-blue-200 rounded-lg transition-colors">
                        <div class="font-semibold text-blue-800">ì‚¼ì„±ì „ì</div>
                        <div class="text-sm text-blue-600">005930.KS</div>
                    </button>
                    <button onclick="selectAndAnalyze('AAPL')" class="p-3 bg-green-100 hover:bg-green-200 rounded-lg transition-colors">
                        <div class="font-semibold text-green-800">Apple</div>
                        <div class="text-sm text-green-600">AAPL</div>
                    </button>
                    <button onclick="selectAndAnalyze('TSLA')" class="p-3 bg-purple-100 hover:bg-purple-200 rounded-lg transition-colors">
                        <div class="font-semibold text-purple-800">Tesla</div>
                        <div class="text-sm text-purple-600">TSLA</div>
                    </button>
                    <button onclick="selectAndAnalyze('GOOGL')" class="p-3 bg-red-100 hover:bg-red-200 rounded-lg transition-colors">
                        <div class="font-semibold text-red-800">Google</div>
                        <div class="text-sm text-red-600">GOOGL</div>
                    </button>
                </div>
            </div>

            <!-- ê²€ìƒ‰ ê²°ê³¼ -->
            <div id="searchResults" class="hidden max-w-2xl mx-auto">
                <h4 class="text-lg font-semibold mb-4">ê²€ìƒ‰ ê²°ê³¼</h4>
                <div id="searchResultsList"></div>
            </div>

            <!-- ë¡œë”© -->
            <div id="searchLoading" class="hidden text-center">
                <div class="inline-block">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                </div>
                <p class="text-gray-600 mt-2">ì¬ë¬´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</p>
            </div>

            <!-- ì‚¬ìš©ë²• ì•ˆë‚´ -->
            <div class="grid md:grid-cols-2 gap-6 text-left mt-8">
                <div>
                    <h4 class="font-semibold mb-3 text-blue-800">
                        <i class="fas fa-lightbulb mr-2"></i>ê²€ìƒ‰ íŒ
                    </h4>
                    <ul class="text-sm text-gray-600 space-y-2">
                        <li><i class="fas fa-check text-green-500 mr-2"></i><strong>í•œêµ­ ê¸°ì—…:</strong> ì‚¼ì„±ì „ì, ë„¤ì´ë²„, í˜„ëŒ€ì°¨</li>
                        <li><i class="fas fa-check text-green-500 mr-2"></i><strong>ë¯¸êµ­ ê¸°ì—…:</strong> ì• í”Œ, Apple, êµ¬ê¸€</li>
                        <li><i class="fas fa-check text-green-500 mr-2"></i><strong>ë„ì–´ì“°ê¸°:</strong> ì‚¼ì„± ì „ì, LG í™”í•™</li>
                        <li><i class="fas fa-magic text-purple-500 mr-2"></i><strong>ì˜¤íƒ€êµì •:</strong> ì‚¼ì„±ì ‡ë‚˜ â†’ ì‚¼ì„±ì „ì</li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-semibold mb-3 text-green-800">
                        <i class="fas fa-chart-line mr-2"></i>ë¶„ì„ ë‚´ìš©
                    </h4>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li><strong>ìˆ˜ìµì„±:</strong> ë§¤ì¶œì´ì´ìµë¥ , ROE, ROA</li>
                        <li><strong>ì•ˆì •ì„±:</strong> ë¶€ì±„ë¹„ìœ¨, ìœ ë™ë¹„ìœ¨</li>
                        <li><strong>ì„±ì¥ì„±:</strong> ë§¤ì¶œ ì„±ì¥ë¥ , ì´ìµ ì„±ì¥ë¥ </li>
                        <li><strong>ë°¸ë¥˜ì—ì´ì…˜:</strong> PER, PBR</li>
                        <li><strong>ì‹¤ì‹œê°„:</strong> ìµœì‹  ì¬ë¬´ ë°ì´í„°</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- íŒŒì¼ ì—…ë¡œë“œ íƒ­ -->
        <div id="content-upload" class="hidden bg-white rounded-lg shadow-lg p-8">
            <div class="text-center">
                <div class="text-6xl mb-4">ğŸ“¤</div>
                <h3 class="text-xl font-semibold mb-2">ì§ì ‘ íŒŒì¼ ì—…ë¡œë“œ</h3>
                <p class="text-gray-600 mb-6">ìì²´ ì¬ë¬´ì œí‘œ íŒŒì¼ì´ ìˆìœ¼ì‹œë©´ ì—…ë¡œë“œí•´ì„œ ë¶„ì„í•˜ì„¸ìš”</p>
                
                <!-- íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ -->
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 mb-6 hover:border-blue-400 transition-colors"
                     ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <input type="file" accept=".xlsx,.xls,.csv" onchange="handleFileUpload(event)" 
                           id="file-upload" class="hidden">
                    <label for="file-upload" class="cursor-pointer">
                        <div class="text-gray-500 mb-2">
                            <i class="fas fa-cloud-upload-alt text-3xl mb-2"></i>
                            <p>íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”</p>
                        </div>
                    </label>
                    <button onclick="document.getElementById('file-upload').click()" 
                            class="mt-4 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fas fa-folder-open mr-2"></i>íŒŒì¼ ì„ íƒ
                    </button>
                </div>
            </div>
        </div>

        <!-- ì¬ë¬´ ë¶„ì„ íƒ­ -->
        <div id="content-analysis" class="hidden space-y-6">
            <!-- ê¸°ì—… ì •ë³´ ì¹´ë“œ -->
            <div id="company-info" class="hidden bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg p-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                    <div>
                        <h2 id="company-name" class="text-2xl font-bold mb-2"></h2>
                        <p id="company-sector" class="opacity-90"></p>
                        <p id="company-market" class="text-sm opacity-75"></p>
                    </div>
                    <div class="mt-4 md:mt-0 text-right">
                        <div id="company-price" class="text-3xl font-bold"></div>
                        <div id="company-change" class="text-sm"></div>
                    </div>
                </div>
            </div>

            <!-- ì¢…í•© ìš”ì•½ -->
            <div id="summary-card" class="hidden bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold mb-4">ğŸ“Š ì¢…í•© ë¶„ì„ ìš”ì•½</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4" id="summary-content">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                </div>
            </div>

            <!-- ìˆ˜ìµì„± ë¶„ì„ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold mb-4">
                    <i class="fas fa-chart-line text-green-600 mr-2"></i>ìˆ˜ìµì„± ë¶„ì„
                </h3>
                <div class="bg-blue-50 p-4 rounded-lg mb-6">
                    <h4 class="font-semibold text-blue-800 mb-2">ğŸ’¡ ìˆ˜ìµì„±ì´ë€?</h4>
                    <p class="text-blue-700 text-sm">
                        ê¸°ì—…ì´ ì–¼ë§ˆë‚˜ íš¨ìœ¨ì ìœ¼ë¡œ ëˆì„ ë²Œê³  ìˆëŠ”ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” ì§€í‘œì…ë‹ˆë‹¤. 
                        ê°™ì€ ë§¤ì¶œì´ë¼ë„ ë¹„ìš©ì„ ì ê²Œ ì“°ê³  ë” ë§ì€ ì´ìµì„ ë‚´ëŠ” íšŒì‚¬ê°€ ìˆ˜ìµì„±ì´ ì¢‹ì€ íšŒì‚¬ì…ë‹ˆë‹¤.
                    </p>
                </div>
                <div id="profitability-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                </div>
            </div>

            <!-- ì•ˆì •ì„± ë¶„ì„ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold mb-4">
                    <i class="fas fa-shield-alt text-purple-600 mr-2"></i>ì•ˆì •ì„± ë¶„ì„
                </h3>
                <div class="bg-purple-50 p-4 rounded-lg mb-6">
                    <h4 class="font-semibold text-purple-800 mb-2">ğŸ›¡ï¸ ì•ˆì •ì„±ì´ë€?</h4>
                    <p class="text-purple-700 text-sm">
                        íšŒì‚¬ê°€ ë¹šì— ì˜ì¡´í•˜ì§€ ì•Šê³  ì•ˆì „í•˜ê²Œ ìš´ì˜ë˜ê³  ìˆëŠ”ì§€ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. 
                        ë¹šì´ ë„ˆë¬´ ë§ìœ¼ë©´ ì´ì ë¶€ë‹´ì´ ì»¤ì ¸ì„œ ìœ„í—˜í•  ìˆ˜ ìˆì–´ìš”.
                    </p>
                </div>
                <div id="stability-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                </div>
            </div>

            <!-- ë°¸ë¥˜ì—ì´ì…˜ ë¶„ì„ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold mb-4">
                    <i class="fas fa-tags text-orange-600 mr-2"></i>ë°¸ë¥˜ì—ì´ì…˜ ë¶„ì„
                </h3>
                <div class="bg-orange-50 p-4 rounded-lg mb-6">
                    <h4 class="font-semibold text-orange-800 mb-2">ğŸ’° ë°¸ë¥˜ì—ì´ì…˜ì´ë€?</h4>
                    <p class="text-orange-700 text-sm">
                        í˜„ì¬ ì£¼ê°€ê°€ ê¸°ì—…ì˜ ì‹¤ì œ ê°€ì¹˜ì— ë¹„í•´ ë¹„ì‹¼ì§€ ì‹¼ì§€ë¥¼ íŒë‹¨í•˜ëŠ” ì§€í‘œì…ë‹ˆë‹¤. 
                        íˆ¬ì ê²°ì •ì— ì¤‘ìš”í•œ ì°¸ê³  ìë£Œê°€ ë©ë‹ˆë‹¤.
                    </p>
                </div>
                <div id="valuation-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                </div>
            </div>
        </div>

        <!-- ì°¨íŠ¸ ë¶„ì„ íƒ­ -->
        <div id="content-charts" class="hidden space-y-6">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold mb-4">
                    <i class="fas fa-chart-area text-indigo-600 mr-2"></i>ì¬ë¬´ ì§€í‘œ ë¹„êµ
                </h3>
                <div class="relative" style="height: 400px;">
                    <canvas id="ratioChart"></canvas>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold mb-4">
                        <i class="fas fa-percentage text-green-600 mr-2"></i>ìˆ˜ìµì„± ì§€í‘œ
                    </h3>
                    <div class="relative" style="height: 300px;">
                        <canvas id="profitChart"></canvas>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold mb-4">
                        <i class="fas fa-balance-scale text-blue-600 mr-2"></i>ë°¸ë¥˜ì—ì´ì…˜
                    </h3>
                    <div class="relative" style="height: 300px;">
                        <canvas id="valuationChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentCompanyData = null;
        let analysisData = null;
        let charts = {};

        // ê¸°ì—…ëª… â†’ í‹°ì»¤ ì‹¬ë³¼ ë§¤í•‘ í…Œì´ë¸”
        const companyNameMap = {
            // í•œêµ­ ê¸°ì—… (ë‹¤ì–‘í•œ í‘œê¸°ë²• í¬í•¨)
            'ì‚¼ì„±ì „ì': '005930.KS',
            'ì‚¼ì„± ì „ì': '005930.KS',
            'samsung': '005930.KS',
            'samsung electronics': '005930.KS',
            
            'skí•˜ì´ë‹‰ìŠ¤': '000660.KS',
            'sk í•˜ì´ë‹‰ìŠ¤': '000660.KS',
            'hynix': '000660.KS',
            
            'ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤': '207940.KS',
            'ì‚¼ì„± ë°”ì´ì˜¤ë¡œì§ìŠ¤': '207940.KS',
            'ì‚¼ì„±ë°”ì´ì˜¤': '207940.KS',
            
            'í˜„ëŒ€ì°¨': '005380.KS',
            'í˜„ëŒ€ìë™ì°¨': '005380.KS',
            'í˜„ëŒ€ ìë™ì°¨': '005380.KS',
            'hyundai': '005380.KS',
            
            'lgí™”í•™': '051910.KS',
            'lg í™”í•™': '051910.KS',
            'lgchem': '051910.KS',
            
            'ì‚¼ì„±sdi': '006400.KS',
            'ì‚¼ì„± sdi': '006400.KS',
            
            'ë„¤ì´ë²„': '035420.KS',
            'naver': '035420.KS',
            
            'í¬ìŠ¤ì½”í™€ë”©ìŠ¤': '005490.KS',
            'í¬ìŠ¤ì½”': '005490.KS',
            'posco': '005490.KS',
            
            'ê¸°ì•„': '000270.KS',
            'kia': '000270.KS',
            
            'ì…€íŠ¸ë¦¬ì˜¨': '068270.KS',
            'celltrion': '068270.KS',
            
            'skì´ë…¸ë² ì´ì…˜': '096770.KS',
            'sk ì´ë…¸ë² ì´ì…˜': '096770.KS',
            
            'lg': '003550.KS',
            
            'í•œêµ­ì „ë ¥': '015760.KS',
            'í•œêµ­ ì „ë ¥': '015760.KS',
            'kepco': '015760.KS',
            
            'skí…”ë ˆì½¤': '017670.KS',
            'sk í…”ë ˆì½¤': '017670.KS',
            'skt': '017670.KS',
            
            'kt': '030200.KS',
            
            'lgì „ì': '066570.KS',
            'lg ì „ì': '066570.KS',
            
            'kbê¸ˆìœµ': '105560.KS',
            'kb ê¸ˆìœµ': '105560.KS',
            'kb': '105560.KS',
            
            'ì‹ í•œì§€ì£¼': '055550.KS',
            'ì‹ í•œ': '055550.KS',
            
            'í•˜ë‚˜ê¸ˆìœµì§€ì£¼': '086790.KS',
            'í•˜ë‚˜ê¸ˆìœµ': '086790.KS',
            'í•˜ë‚˜': '086790.KS',
            
            'ì¹´ì¹´ì˜¤ë±…í¬': '323410.KS',
            'ì¹´ì¹´ì˜¤ ë±…í¬': '323410.KS',
            
            // ë¯¸êµ­ ê¸°ì—… (ë‹¤ì–‘í•œ í‘œê¸°ë²• í¬í•¨)
            'ì• í”Œ': 'AAPL',
            'apple': 'AAPL',
            
            'ë§ˆì´í¬ë¡œì†Œí”„íŠ¸': 'MSFT',
            'ë§ˆì´í¬ë¡œ ì†Œí”„íŠ¸': 'MSFT',
            'microsoft': 'MSFT',
            'ms': 'MSFT',
            
            'êµ¬ê¸€': 'GOOGL',
            'google': 'GOOGL',
            'alphabet': 'GOOGL',
            'ì•ŒíŒŒë²³': 'GOOGL',
            
            'ì•„ë§ˆì¡´': 'AMZN',
            'amazon': 'AMZN',
            
            'í…ŒìŠ¬ë¼': 'TSLA',
            'tesla': 'TSLA',
            
            'ë©”íƒ€': 'META',
            'meta': 'META',
            'í˜ì´ìŠ¤ë¶': 'META',
            'facebook': 'META',
            
            'ì—”ë¹„ë””ì•„': 'NVDA',
            'nvidia': 'NVDA',
            
            'ë„·í”Œë¦­ìŠ¤': 'NFLX',
            'netflix': 'NFLX',
            
            'jpëª¨ê±´': 'JPM',
            'jpmorgan': 'JPM',
            'chase': 'JPM',
            
            'ì¡´ìŠ¨ì•¤ì¡´ìŠ¨': 'JNJ',
            'johnson': 'JNJ',
            
            'ë¹„ì': 'V',
            'visa': 'V',
            
            'ì›”ë§ˆíŠ¸': 'WMT',
            'walmart': 'WMT',
            
            'ë§ˆìŠ¤í„°ì¹´ë“œ': 'MA',
            'mastercard': 'MA',
            
            'í™ˆë””í¬': 'HD',
            'homedepot': 'HD',
            'home depot': 'HD',
            
            'ë±…í¬ì˜¤ë¸Œì•„ë©”ë¦¬ì¹´': 'BAC',
            'bank of america': 'BAC',
            'boa': 'BAC',
            
            'ë””ì¦ˆë‹ˆ': 'DIS',
            'disney': 'DIS',
            
            'ì–´ë„ë¹„': 'ADBE',
            'adobe': 'ADBE',
            
            'ì„¸ì¼ì¦ˆí¬ìŠ¤': 'CRM',
            'salesforce': 'CRM',
            
            'í˜ì´íŒ”': 'PYPL',
            'paypal': 'PYPL',
            
            // ê¸°íƒ€ ê¸€ë¡œë²Œ ê¸°ì—…
            'asml': 'ASML',
            'tsmc': 'TSM',
            'ëŒ€ë§Œë°˜ë„ì²´': 'TSM',
            'novo': 'NVO',
            'í† ìš”íƒ€': 'TM',
            'toyota': 'TM',
            'ì•Œë¦¬ë°”ë°”': 'BABA',
            'alibaba': 'BABA',
            'í…ì„¼íŠ¸': 'TCEHY',
            'tencent': 'TCEHY',
            'unilever': 'UL',
            'novartis': 'NVS',
            'roche': 'RHHBY',
            'nestle': 'NESN.SW',
            'ë„¤ìŠ¬ë ˆ': 'NESN.SW',
            
            // ì•”í˜¸í™”í ê´€ë ¨
            'ì½”ì¸ë² ì´ìŠ¤': 'COIN',
            'coinbase': 'COIN',
            'ë§ˆì´í¬ë¡œìŠ¤íŠ¸ë˜í‹°ì§€': 'MSTR',
            'microstrategy': 'MSTR',
            'block': 'SQ',
            'riot': 'RIOT'
        };

        // Levenshtein Distance ê³„ì‚° (ì˜¤íƒ€ ìœ ì‚¬ë„)
        function levenshteinDistance(str1, str2) {
            const matrix = [];
            const len1 = str1.length;
            const len2 = str2.length;

            // ë¹ˆ ë¬¸ìì—´ ì²˜ë¦¬
            if (len1 === 0) return len2;
            if (len2 === 0) return len1;

            // ë§¤íŠ¸ë¦­ìŠ¤ ì´ˆê¸°í™”
            for (let i = 0; i <= len1; i++) {
                matrix[i] = [i];
            }
            for (let j = 0; j <= len2; j++) {
                matrix[0][j] = j;
            }

            // ê±°ë¦¬ ê³„ì‚°
            for (let i = 1; i <= len1; i++) {
                for (let j = 1; j <= len2; j++) {
                    const cost = str1[i - 1] === str2[j - 1] ? 0 : 1;
                    matrix[i][j] = Math.min(
                        matrix[i - 1][j] + 1,        // ì‚­ì œ
                        matrix[i][j - 1] + 1,        // ì‚½ì…
                        matrix[i - 1][j - 1] + cost  // ëŒ€ì²´
                    );
                }
            }

            return matrix[len1][len2];
        }

        // ìœ ì‚¬ë„ ì ìˆ˜ ê³„ì‚° (0~100)
        function getSimilarityScore(str1, str2) {
            const maxLen = Math.max(str1.length, str2.length);
            if (maxLen === 0) return 100;
            
            const distance = levenshteinDistance(str1.toLowerCase(), str2.toLowerCase());
            return Math.round((1 - distance / maxLen) * 100);
        }

        // ê¸°ì—…ëª…ì„ í‹°ì»¤ ì‹¬ë³¼ë¡œ ë³€í™˜ (ì˜¤íƒ€ êµì • í¬í•¨)
        function convertNameToSymbol(input) {
            const cleanInput = input.toLowerCase().trim().replace(/\s+/g, ' ');
            
            // 1. ì •í™•í•œ ë§¤ì¹­
            if (companyNameMap[cleanInput]) {
                return companyNameMap[cleanInput];
            }
            
            // 2. ê³µë°± ì œê±°í•´ì„œ ì¬ì‹œë„
            const noSpaceInput = cleanInput.replace(/\s/g, '');
            for (const [name, symbol] of Object.entries(companyNameMap)) {
                if (name.replace(/\s/g, '') === noSpaceInput) {
                    return symbol;
                }
            }
            
            // 3. ë¶€ë¶„ ë§¤ì¹­ (í¬í•¨ ê´€ê³„)
            for (const [name, symbol] of Object.entries(companyNameMap)) {
                if (name.includes(cleanInput) || cleanInput.includes(name)) {
                    return symbol;
                }
            }
            
            // 4. ì˜¤íƒ€ êµì • (ìœ ì‚¬ë„ ê¸°ë°˜)
            let bestMatch = null;
            let bestScore = 0;
            const minSimilarity = 60; // ìµœì†Œ 60% ìœ ì‚¬ë„
            
            for (const [name, symbol] of Object.entries(companyNameMap)) {
                // ê³µë°± ì œê±°í•œ ë²„ì „ë„ ë¹„êµ
                const nameNoSpace = name.replace(/\s/g, '');
                const inputNoSpace = cleanInput.replace(/\s/g, '');
                
                // ì›ë³¸ê³¼ ë¹„êµ
                const score1 = getSimilarityScore(cleanInput, name);
                // ê³µë°± ì œê±° ë²„ì „ê³¼ ë¹„êµ
                const score2 = getSimilarityScore(inputNoSpace, nameNoSpace);
                
                const maxScore = Math.max(score1, score2);
                
                if (maxScore > bestScore && maxScore >= minSimilarity) {
                    bestScore = maxScore;
                    bestMatch = { name, symbol, score: maxScore };
                }
            }
            
            // ì˜¤íƒ€ êµì • ê²°ê³¼ê°€ ìˆìœ¼ë©´ í™•ì¸ í›„ ì‚¬ìš©
            if (bestMatch) {
                console.log(`ğŸ”§ ì˜¤íƒ€ êµì •: "${input}" â†’ "${bestMatch.name}" (ìœ ì‚¬ë„: ${bestMatch.score}%)`);
                
                // ìœ ì‚¬ë„ê°€ 80% ì´ìƒì´ë©´ ìë™ êµì •
                if (bestMatch.score >= 80) {
                    return bestMatch.symbol;
                }
                // 60-79%ë©´ ì‚¬ìš©ìì—ê²Œ í™•ì¸
                else if (bestMatch.score >= 60) {
                    const confirmed = confirm(`"${bestMatch.name}"ì„(ë¥¼) ì°¾ìœ¼ì‹œë‚˜ìš”?\n(ìœ ì‚¬ë„: ${bestMatch.score}%)`);
                    if (confirmed) {
                        return bestMatch.symbol;
                    }
                }
            }
            
            // ë³€í™˜ ì‹¤íŒ¨ì‹œ ì›ë³¸ ë°˜í™˜ (í‹°ì»¤ ì‹¬ë³¼ì¼ ìˆ˜ë„ ìˆìŒ)
            return input.toUpperCase();
        }

        // ê²€ìƒ‰ ì œì•ˆ ê¸°ëŠ¥ (ì˜¤íƒ€ êµì • í¬í•¨)
        function getSuggestions(input) {
            const cleanInput = input.toLowerCase().trim();
            const suggestions = [];
            const suggestionMap = new Map(); // ì¤‘ë³µ ì œê±°ìš©
            
            // 1. ì •í™•í•œ ë§¤ì¹­ ë° ë¶€ë¶„ ë§¤ì¹­
            for (const [name, symbol] of Object.entries(companyNameMap)) {
                if (name.includes(cleanInput) || cleanInput.includes(name)) {
                    if (!suggestionMap.has(symbol)) {
                        suggestions.push({ name, symbol, type: 'ì •í™•ë§¤ì¹­', score: 100 });
                        suggestionMap.set(symbol, true);
                    }
                }
            }
            
            // 2. ì˜¤íƒ€ êµì • ì œì•ˆ (ì •í™•í•œ ë§¤ì¹­ì´ ë¶€ì¡±í•  ë•Œë§Œ)
            if (suggestions.length < 3 && cleanInput.length >= 2) {
                const typoSuggestions = [];
                
                for (const [name, symbol] of Object.entries(companyNameMap)) {
                    if (!suggestionMap.has(symbol)) {
                        const nameNoSpace = name.replace(/\s/g, '');
                        const inputNoSpace = cleanInput.replace(/\s/g, '');
                        
                        const score1 = getSimilarityScore(cleanInput, name);
                        const score2 = getSimilarityScore(inputNoSpace, nameNoSpace);
                        const maxScore = Math.max(score1, score2);
                        
                        if (maxScore >= 50) { // 50% ì´ìƒ ìœ ì‚¬ë„
                            typoSuggestions.push({ name, symbol, type: 'ì˜¤íƒ€êµì •', score: maxScore });
                        }
                    }
                }
                
                // ìœ ì‚¬ë„ ìˆœìœ¼ë¡œ ì •ë ¬
                typoSuggestions.sort((a, b) => b.score - a.score);
                
                // ìƒìœ„ ëª‡ ê°œë§Œ ì¶”ê°€
                suggestions.push(...typoSuggestions.slice(0, 3));
            }
            
            return suggestions.slice(0, 5); // ìµœëŒ€ 5ê°œë§Œ
        }

        // íƒ­ ì „í™˜ ê¸°ëŠ¥
        function showTab(tabName) {
            const tabs = ['search', 'upload', 'analysis', 'charts'];
            
            tabs.forEach(tab => {
                const tabBtn = document.getElementById(`tab-${tab}`);
                const content = document.getElementById(`content-${tab}`);
                
                if (tab === tabName) {
                    tabBtn.className = 'flex-1 min-w-0 py-3 px-4 text-sm font-medium bg-blue-600 text-white border-r border-gray-200 transition-colors';
                    content.classList.remove('hidden');
                } else {
                    tabBtn.className = 'flex-1 min-w-0 py-3 px-4 text-sm font-medium text-gray-600 hover:bg-gray-50 border-r border-gray-200 transition-colors';
                    content.classList.add('hidden');
                }
            });
        }

        // ë“œë¡­ë‹¤ìš´ì—ì„œ ê¸°ì—… ì„ íƒ ì²˜ë¦¬
        function handleCompanySelect(event) {
            const symbol = event.target.value;
            if (symbol) {
                analyzeCompany(symbol);
            }
        }

        // ì§ì ‘ ì…ë ¥ í† ê¸€
        function toggleCustomInput() {
            const customDiv = document.getElementById('customInputDiv');
            const btn = document.getElementById('customInputBtn');
            
            if (customDiv && btn) {
                if (customDiv.classList.contains('hidden')) {
                    customDiv.classList.remove('hidden');
                    btn.textContent = 'ëª©ë¡ì—ì„œ ì„ íƒí•˜ê¸°';
                    
                    // ì•ˆì „í•˜ê²Œ í¬ì»¤ìŠ¤
                    setTimeout(() => {
                        const customInput = document.getElementById('customCompanyInput');
                        if (customInput) {
                            customInput.focus();
                        }
                    }, 50);
                } else {
                    customDiv.classList.add('hidden');
                    btn.textContent = 'ë‹¤ë¥¸ ê¸°ì—… ì§ì ‘ ì…ë ¥í•˜ê¸°';
                    
                    // ì œì•ˆ ëª©ë¡ ìˆ¨ê¸°ê¸°
                    const suggestionsDiv = document.getElementById('searchSuggestions');
                    if (suggestionsDiv) {
                        suggestionsDiv.classList.add('hidden');
                    }
                }
            }
        }

        // ì§ì ‘ ì…ë ¥ í‚¤ ì²˜ë¦¬
        function handleCustomInputKeyPress(event) {
            if (event.key === 'Enter') {
                analyzeCustomCompany();
            }
        }

        // ê²€ìƒ‰ ì œì•ˆ ì²˜ë¦¬
        function handleSearchSuggestions(event) {
            const input = event.target.value.trim();
            const suggestionsDiv = document.getElementById('searchSuggestions');
            
            if (input.length < 2) {
                suggestionsDiv.classList.add('hidden');
                return;
            }
            
            const suggestions = getSuggestions(input);
            
            if (suggestions.length === 0) {
                suggestionsDiv.classList.add('hidden');
                return;
            }
            
            let html = '';
            suggestions.forEach(suggestion => {
                const typeIcon = suggestion.type === 'ì •í™•ë§¤ì¹­' ? 'âœ…' : 'ğŸ”§';
                const scoreText = suggestion.type === 'ì˜¤íƒ€êµì •' ? ` (ìœ ì‚¬ë„: ${suggestion.score}%)` : '';
                
                html += `
                    <div class="p-3 hover:bg-gray-100 cursor-pointer border-b border-gray-200 last:border-b-0" 
                         onclick="selectSuggestion('${suggestion.symbol}', '${suggestion.name}')">
                        <div class="flex items-center justify-between">
                            <div class="font-medium text-gray-800">${typeIcon} ${suggestion.name}</div>
                            <div class="text-xs text-gray-500">${suggestion.type}</div>
                        </div>
                        <div class="text-sm text-gray-600">${suggestion.symbol}${scoreText}</div>
                    </div>
                `;
            });
            
            suggestionsDiv.innerHTML = html;
            suggestionsDiv.classList.remove('hidden');
        }

        // ì œì•ˆ ì„ íƒ
        function selectSuggestion(symbol, name) {
            const customInput = document.getElementById('customCompanyInput');
            const suggestionsDiv = document.getElementById('searchSuggestions');
            
            if (customInput) {
                customInput.value = name;
            }
            suggestionsDiv.classList.add('hidden');
            
            // ë°”ë¡œ ë¶„ì„ ì‹¤í–‰
            analyzeCompany(symbol);
        }

        // ì§ì ‘ ì…ë ¥ëœ ê¸°ì—… ë¶„ì„ (ê¸°ì—…ëª… ë³€í™˜ ê¸°ëŠ¥ ì¶”ê°€)
        function analyzeCustomCompany() {
            const customInput = document.getElementById('customCompanyInput');
            if (!customInput) {
                alert('ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const userInput = customInput.value.trim();
            if (!userInput) {
                alert('ê¸°ì—…ëª…ì´ë‚˜ í‹°ì»¤ ì‹¬ë³¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ê¸°ì—…ëª…ì„ í‹°ì»¤ ì‹¬ë³¼ë¡œ ë³€í™˜
            const symbol = convertNameToSymbol(userInput);
            
            // ì œì•ˆ ëª©ë¡ ìˆ¨ê¸°ê¸°
            const suggestionsDiv = document.getElementById('searchSuggestions');
            if (suggestionsDiv) {
                suggestionsDiv.classList.add('hidden');
            }
            
            console.log(`ì…ë ¥: "${userInput}" â†’ ë³€í™˜ëœ ì‹¬ë³¼: "${symbol}"`);
            
            analyzeCompany(symbol);
        }

        // ë¹ ë¥¸ ë¶„ì„ ë²„íŠ¼ (ë“œë¡­ë‹¤ìš´ë„ í•¨ê»˜ ì„ íƒ)
        function selectAndAnalyze(symbol) {
            // ë“œë¡­ë‹¤ìš´ì—ì„œ í•´ë‹¹ ê¸°ì—… ì„ íƒ (ì•ˆì „í•˜ê²Œ)
            const companySelect = document.getElementById('companySelect');
            if (companySelect) {
                companySelect.value = symbol;
            }
            // ë¶„ì„ ì‹¤í–‰
            analyzeCompany(symbol);
        }

        // ê²€ìƒ‰ í‚¤ ì…ë ¥ ì²˜ë¦¬ (ê¸°ì¡´ í•¨ìˆ˜ ìœ ì§€)
        function handleSearchKeyPress(event) {
            if (event.key === 'Enter') {
                searchCompany();
            }
        }

        // ê¸°ì—… ê²€ìƒ‰ (ê¸°ì¡´ í•¨ìˆ˜ ìˆ˜ì •)
        function searchCompany() {
            const query = document.getElementById('customCompanyInput').value.trim();
            if (!query) {
                alert('ê¸°ì—…ëª…ì´ë‚˜ í‹°ì»¤ ì‹¬ë³¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ë°”ë¡œ ë¶„ì„ ì‹œë„
            analyzeCompany(query);
        }

        // ê¸°ì—… ë¶„ì„
        async function analyzeCompany(symbol) {
            showLoading(true);
            
            try {
                // ì—¬ëŸ¬ API ì—”ë“œí¬ì¸íŠ¸ì—ì„œ ë°ì´í„° ìˆ˜ì§‘
                const [quoteData, financialData, statisticsData] = await Promise.all([
                    fetchYahooData(symbol, 'quoteSummary', 'price,summaryDetail'),
                    fetchYahooData(symbol, 'quoteSummary', 'financialData,defaultKeyStatistics'),
                    fetchYahooData(symbol, 'quoteSummary', 'summaryProfile,assetProfile')
                ]);

                if (!quoteData && !financialData) {
                    throw new Error('í•´ë‹¹ ê¸°ì—…ì˜ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì •í™•í•œ í‹°ì»¤ ì‹¬ë³¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                }

                // ë°ì´í„° í†µí•©
                currentCompanyData = {
                    symbol: symbol.toUpperCase(),
                    quote: quoteData,
                    financial: financialData,
                    profile: statisticsData
                };

                // ë¶„ì„ ì‹¤í–‰
                performAnalysis(currentCompanyData);
                
                // ë¶„ì„ íƒ­ìœ¼ë¡œ ì´ë™
                showTab('analysis');
                
                alert(`âœ… ${symbol} ë¶„ì„ ì™„ë£Œ!\nì‹¤ì‹œê°„ ì¬ë¬´ ë°ì´í„°ë¥¼ ë¶„ì„í–ˆìŠµë‹ˆë‹¤.`);
                
            } catch (error) {
                console.error('ë¶„ì„ ì˜¤ë¥˜:', error);
                alert('âŒ ' + error.message + '\n\nğŸ’¡ ê²€ìƒ‰ íŒ:\n- í•œêµ­ ê¸°ì—…: 005930.KS (ì‚¼ì„±ì „ì)\n- ë¯¸êµ­ ê¸°ì—…: AAPL (ì• í”Œ)');
            }
            
            showLoading(false);
        }

        // Yahoo Finance API í˜¸ì¶œ
        async function fetchYahooData(symbol, endpoint, modules) {
            try {
                const url = `https://query1.finance.yahoo.com/v10/finance/${endpoint}/${symbol}?modules=${modules}`;
                
                // CORS ìš°íšŒë¥¼ ìœ„í•œ í”„ë¡ì‹œ ì‚¬ìš©
                const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
                
                const response = await fetch(proxyUrl);
                const data = await response.json();
                
                if (data.contents) {
                    const yahooData = JSON.parse(data.contents);
                    return yahooData.quoteSummary?.result?.[0];
                }
                
                return null;
            } catch (error) {
                console.error('API í˜¸ì¶œ ì˜¤ë¥˜:', error);
                return null;
            }
        }

        // ì¬ë¬´ ë¶„ì„ ìˆ˜í–‰
        function performAnalysis(companyData) {
            const financial = companyData.financial?.financialData || {};
            const statistics = companyData.financial?.defaultKeyStatistics || {};
            const quote = companyData.quote?.price || {};
            const summaryDetail = companyData.quote?.summaryDetail || {};

            // ê¸°ì—… ì •ë³´ í‘œì‹œ
            displayCompanyInfo(companyData);

            // ì¬ë¬´ ë¹„ìœ¨ ê³„ì‚°
            const analysis = {
                profitability: {
                    profitMargins: financial.profitMargins?.raw * 100 || 0,
                    operatingMargins: financial.operatingMargins?.raw * 100 || 0,
                    returnOnEquity: financial.returnOnEquity?.raw * 100 || 0,
                    returnOnAssets: financial.returnOnAssets?.raw * 100 || 0,
                    grossMargins: financial.grossMargins?.raw * 100 || 0
                },
                stability: {
                    debtToEquity: financial.debtToEquity?.raw || 0,
                    currentRatio: financial.currentRatio?.raw || 0,
                    quickRatio: financial.quickRatio?.raw || 0
                },
                valuation: {
                    peRatio: summaryDetail.trailingPE?.raw || 0,
                    pbRatio: statistics.priceToBook?.raw || 0,
                    pegRatio: statistics.pegRatio?.raw || 0,
                    priceToSales: statistics.priceToSalesTrailing12Months?.raw || 0
                },
                marketCap: quote.marketCap?.raw || 0,
                price: quote.regularMarketPrice?.raw || 0,
                change: quote.regularMarketChangePercent?.raw * 100 || 0
            };

            analysisData = analysis;
            displayAnalysis(analysis);
            createCharts(analysis);
        }

        // ê¸°ì—… ì •ë³´ í‘œì‹œ
        function displayCompanyInfo(companyData) {
            const quote = companyData.quote?.price || {};
            const profile = companyData.profile?.summaryProfile || {};
            
            const companyInfoDiv = document.getElementById('company-info');
            const companyName = document.getElementById('company-name');
            const companySector = document.getElementById('company-sector');
            const companyMarket = document.getElementById('company-market');
            const companyPrice = document.getElementById('company-price');
            const companyChange = document.getElementById('company-change');

            companyName.textContent = quote.longName || quote.shortName || companyData.symbol;
            companySector.textContent = profile.sector || 'ì •ë³´ ì—†ìŒ';
            companyMarket.textContent = `${quote.exchangeName || ''} | ${companyData.symbol}`;
            
            const price = quote.regularMarketPrice?.raw || 0;
            const currency = quote.currency || 'USD';
            companyPrice.textContent = `${price.toLocaleString()} ${currency}`;
            
            const change = quote.regularMarketChangePercent?.raw * 100 || 0;
            const changeColor = change >= 0 ? 'text-green-300' : 'text-red-300';
            companyChange.innerHTML = `<span class="${changeColor}">${change >= 0 ? '+' : ''}${change.toFixed(2)}%</span>`;
            
            companyInfoDiv.classList.remove('hidden');
        }

        // ë¶„ì„ ê²°ê³¼ í‘œì‹œ
        function displayAnalysis(analysis) {
            displaySummary(analysis);
            
            // ìˆ˜ìµì„± ì¹´ë“œ
            displayRatioCards('profitability-cards', [
                { title: 'ìˆœì´ìµë¥ ', value: analysis.profitability.profitMargins, unit: '%', good: 10, excellent: 20, description: 'ë§¤ì¶œ ëŒ€ë¹„ ìˆœì´ìµ ë¹„ìœ¨. ë†’ì„ìˆ˜ë¡ íš¨ìœ¨ì ì¸ ê²½ì˜' },
                { title: 'ì˜ì—…ì´ìµë¥ ', value: analysis.profitability.operatingMargins, unit: '%', good: 15, excellent: 25, description: 'ë³¸ì—…ì—ì„œì˜ ìˆ˜ìµì„±. í•µì‹¬ ì‚¬ì—… ê²½ìŸë ¥ì„ ë‚˜íƒ€ëƒ„' },
                { title: 'ROE', value: analysis.profitability.returnOnEquity, unit: '%', good: 10, excellent: 20, description: 'ìê¸°ìë³¸ ëŒ€ë¹„ ìˆœì´ìµë¥ . ì£¼ì£¼ íˆ¬ì íš¨ìœ¨ì„±' },
                { title: 'ROA', value: analysis.profitability.returnOnAssets, unit: '%', good: 5, excellent: 15, description: 'ì´ìì‚° ëŒ€ë¹„ ìˆœì´ìµë¥ . ìì‚° í™œìš© íš¨ìœ¨ì„±' },
                { title: 'ë§¤ì¶œì´ì´ìµë¥ ', value: analysis.profitability.grossMargins, unit: '%', good: 25, excellent: 40, description: 'ë§¤ì¶œ ëŒ€ë¹„ ë§¤ì¶œì´ì´ìµ ë¹„ìœ¨. ê°€ê²© ê²½ìŸë ¥' }
            ]);

            // ì•ˆì •ì„± ì¹´ë“œ
            displayRatioCards('stability-cards', [
                { title: 'ë¶€ì±„ë¹„ìœ¨', value: analysis.stability.debtToEquity, unit: '', good: 1.0, excellent: 0.5, description: 'ë¶€ì±„ ëŒ€ë¹„ ìê¸°ìë³¸ ë¹„ìœ¨. ë‚®ì„ìˆ˜ë¡ ì•ˆì „', reverse: true },
                { title: 'ìœ ë™ë¹„ìœ¨', value: analysis.stability.currentRatio, unit: '', good: 1.5, excellent: 2.0, description: 'ë‹¨ê¸° ì±„ë¬´ ìƒí™˜ ëŠ¥ë ¥. 2.0 ì´ìƒì´ë©´ ì•ˆì „' },
                { title: 'ë‹¹ì¢Œë¹„ìœ¨', value: analysis.stability.quickRatio, unit: '', good: 1.0, excellent: 1.5, description: 'ì¦‰ì‹œ í˜„ê¸ˆí™” ê°€ëŠ¥í•œ ìì‚°ìœ¼ë¡œ ë‹¨ê¸° ì±„ë¬´ ìƒí™˜ ëŠ¥ë ¥' }
            ]);

            // ë°¸ë¥˜ì—ì´ì…˜ ì¹´ë“œ
            displayRatioCards('valuation-cards', [
                { title: 'PER', value: analysis.valuation.peRatio, unit: 'ë°°', good: 20, excellent: 15, description: 'ì£¼ê°€ ëŒ€ë¹„ ì£¼ë‹¹ìˆœì´ìµ. ë‚®ì„ìˆ˜ë¡ ì €í‰ê°€', reverse: true },
                { title: 'PBR', value: analysis.valuation.pbRatio, unit: 'ë°°', good: 2.0, excellent: 1.0, description: 'ì£¼ê°€ ëŒ€ë¹„ ì£¼ë‹¹ìˆœìì‚°. 1.0 ì´í•˜ë©´ ì €í‰ê°€', reverse: true },
                { title: 'PEG', value: analysis.valuation.pegRatio, unit: '', good: 1.5, excellent: 1.0, description: 'PERì„ ì„±ì¥ë¥ ë¡œ ë‚˜ëˆˆ ê°’. 1.0 ì´í•˜ë©´ ì €í‰ê°€', reverse: true },
                { title: 'PSR', value: analysis.valuation.priceToSales, unit: 'ë°°', good: 3.0, excellent: 1.0, description: 'ì£¼ê°€ ëŒ€ë¹„ ì£¼ë‹¹ë§¤ì¶œ. ë‚®ì„ìˆ˜ë¡ ì €í‰ê°€', reverse: true }
            ]);
        }

        // ì¢…í•© ìš”ì•½ í‘œì‹œ
        function displaySummary(analysis) {
            const summaryCard = document.getElementById('summary-card');
            const summaryContent = document.getElementById('summary-content');
            
            // ì¢…í•© ì ìˆ˜ ê³„ì‚°
            const profitScore = calculateScore(analysis.profitability.profitMargins, 10, 20);
            const stabilityScore = calculateScore(analysis.stability.currentRatio, 1.5, 2.0);
            const valuationScore = calculateScore(20 - analysis.valuation.peRatio, 5, 15); // PERëŠ” ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ
            
            const overallScore = Math.round((profitScore + stabilityScore + valuationScore) / 3);
            
            summaryContent.innerHTML = `
                <div class="text-center">
                    <div class="text-3xl font-bold mb-2 text-blue-600">${overallScore}/100</div>
                    <div class="text-sm text-gray-600">ì¢…í•© ì ìˆ˜</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold mb-2 text-green-600">${getGrade(overallScore)}</div>
                    <div class="text-sm text-gray-600">ì¬ë¬´ ë“±ê¸‰</div>
                </div>
                <div class="text-center">
                    <div class="text-xl font-bold mb-2 text-purple-600">${analysis.profitability.profitMargins.toFixed(1)}%</div>
                    <div class="text-sm text-gray-600">ìˆœì´ìµë¥ </div>
                </div>
                <div class="text-center">
                    <div class="text-xl font-bold mb-2 text-orange-600">${analysis.valuation.peRatio > 0 ? analysis.valuation.peRatio.toFixed(1) : 'N/A'}ë°°</div>
                    <div class="text-sm text-gray-600">PER</div>
                </div>
            `;
            
            summaryCard.classList.remove('hidden');
        }

        // ì ìˆ˜ ê³„ì‚° í•¨ìˆ˜
        function calculateScore(value, good, excellent) {
            if (value >= excellent) return 100;
            if (value >= good) return 70 + (value - good) / (excellent - good) * 30;
            if (value >= 0) return value / good * 70;
            return 0;
        }

        // ë“±ê¸‰ ê³„ì‚° í•¨ìˆ˜
        function getGrade(score) {
            if (score >= 90) return 'A+';
            if (score >= 80) return 'A';
            if (score >= 70) return 'B+';
            if (score >= 60) return 'B';
            if (score >= 50) return 'C+';
            if (score >= 40) return 'C';
            return 'D';
        }

        // ë¹„ìœ¨ ì¹´ë“œ í‘œì‹œ
        function displayRatioCards(containerId, ratios) {
            const container = document.getElementById(containerId);
            let html = '';

            ratios.forEach(ratio => {
                const status = getRatioStatus(ratio.value, ratio.good, ratio.excellent, ratio.reverse);
                const displayValue = typeof ratio.value === 'number' && ratio.value !== 0 ? 
                    ratio.value.toFixed(1) : 'N/A';
                
                html += `
                    <div class="ratio-card bg-white p-4 rounded-lg shadow-md border-l-4 ${status.borderColor}">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-medium text-gray-700 text-sm">${ratio.title}</h4>
                            <i class="fas ${status.icon} ${status.color}"></i>
                        </div>
                        <div class="flex items-end gap-1 mb-2">
                            <span class="text-2xl font-bold ${status.color}">${displayValue}</span>
                            <span class="text-sm text-gray-500">${ratio.unit}</span>
                        </div>
                        <p class="text-xs text-gray-500 leading-tight">${ratio.description}</p>
                        ${ratio.value > 0 ? `
                        <div class="mt-2">
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="${status.bgColor} h-2 rounded-full transition-all duration-500" 
                                     style="width: ${Math.min(100, Math.max(10, getProgressWidth(ratio.value, ratio.good, ratio.excellent, ratio.reverse)))}%"></div>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // ì§„í–‰ë¥  ê³„ì‚°
        function getProgressWidth(value, good, excellent, reverse = false) {
            if (reverse) {
                // PER, PBR ë“±ì€ ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ
                if (value <= excellent) return 100;
                if (value <= good) return 70;
                return Math.max(20, 100 - (value / good) * 50);
            } else {
                // ì¼ë°˜ì ì¸ ê²½ìš° ë†’ì„ìˆ˜ë¡ ì¢‹ìŒ
                if (value >= excellent) return 100;
                if (value >= good) return 70;
                return Math.max(10, (value / good) * 70);
            }
        }

        // ë¹„ìœ¨ ìƒíƒœ ê³„ì‚°
        function getRatioStatus(value, good, excellent, reverse = false) {
            let isGood = false;
            
            if (reverse) {
                // ë‚®ì„ìˆ˜ë¡ ì¢‹ì€ ì§€í‘œ (PER, ë¶€ì±„ë¹„ìœ¨ ë“±)
                isGood = value <= excellent || (value <= good && value > 0);
            } else {
                // ë†’ì„ìˆ˜ë¡ ì¢‹ì€ ì§€í‘œ
                isGood = value >= excellent || (value >= good && value > 0);
            }
            
            if (value === 0 || value === null || value === undefined) {
                return {
                    status: 'unknown',
                    color: 'text-gray-600',
                    icon: 'fa-question',
                    borderColor: 'border-l-gray-500',
                    bgColor: 'bg-gray-500'
                };
            }
            
            if (isGood) {
                if ((reverse && value <= excellent) || (!reverse && value >= excellent)) {
                    return {
                        status: 'excellent',
                        color: 'text-green-600',
                        icon: 'fa-arrow-up',
                        borderColor: 'border-l-green-500',
                        bgColor: 'bg-green-500'
                    };
                } else {
                    return {
                        status: 'good',
                        color: 'text-blue-600',
                        icon: 'fa-arrow-up',
                        borderColor: 'border-l-blue-500',
                        bgColor: 'bg-blue-500'
                    };
                }
            } else {
                return {
                    status: 'warning',
                    color: 'text-red-600',
                    icon: 'fa-arrow-down',
                    borderColor: 'border-l-red-500',
                    bgColor: 'bg-red-500'
                };
            }
        }

        // ì°¨íŠ¸ ìƒì„±
        function createCharts(analysis) {
            // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });

            // ì¢…í•© ë¹„ìœ¨ ì°¨íŠ¸
            const ratioCtx = document.getElementById('ratioChart').getContext('2d');
            charts.ratio = new Chart(ratioCtx, {
                type: 'radar',
                data: {
                    labels: ['ìˆ˜ìµì„±', 'ì•ˆì •ì„±', 'ì„±ì¥ì„±', 'íš¨ìœ¨ì„±', 'ë°¸ë¥˜ì—ì´ì…˜'],
                    datasets: [{
                        label: 'ì¬ë¬´ ì§€í‘œ',
                        data: [
                            Math.min(100, analysis.profitability.profitMargins * 5),
                            Math.min(100, analysis.stability.currentRatio * 50),
                            Math.min(100, analysis.profitability.returnOnEquity * 3),
                            Math.min(100, analysis.profitability.returnOnAssets * 5),
                            Math.min(100, Math.max(0, 100 - analysis.valuation.peRatio * 2))
                        ],
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: 'rgb(59, 130, 246)',
                        pointBackgroundColor: 'rgb(59, 130, 246)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(59, 130, 246)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: {
                        line: {
                            borderWidth: 3
                        }
                    },
                    scales: {
                        r: {
                            angleLines: {
                                display: false
                            },
                            suggestedMin: 0,
                            suggestedMax: 100
                        }
                    }
                }
            });

            // ìˆ˜ìµì„± ì°¨íŠ¸
            const profitCtx = document.getElementById('profitChart').getContext('2d');
            charts.profit = new Chart(profitCtx, {
                type: 'bar',
                data: {
                    labels: ['ìˆœì´ìµë¥ ', 'ì˜ì—…ì´ìµë¥ ', 'ROE', 'ROA'],
                    datasets: [{
                        label: 'ìˆ˜ìµì„± (%)',
                        data: [
                            analysis.profitability.profitMargins,
                            analysis.profitability.operatingMargins,
                            analysis.profitability.returnOnEquity,
                            analysis.profitability.returnOnAssets
                        ],
                        backgroundColor: [
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(139, 92, 246, 0.8)',
                            'rgba(245, 158, 11, 0.8)'
                        ],
                        borderColor: [
                            'rgb(34, 197, 94)',
                            'rgb(59, 130, 246)',
                            'rgb(139, 92, 246)',
                            'rgb(245, 158, 11)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });

            // ë°¸ë¥˜ì—ì´ì…˜ ì°¨íŠ¸
            const valuationCtx = document.getElementById('valuationChart').getContext('2d');
            charts.valuation = new Chart(valuationCtx, {
                type: 'doughnut',
                data: {
                    labels: ['ì ì • PER', 'í˜„ì¬ PER í”„ë¦¬ë¯¸ì—„'],
                    datasets: [{
                        data: [
                            Math.min(20, analysis.valuation.peRatio),
                            Math.max(0, analysis.valuation.peRatio - 20)
                        ],
                        backgroundColor: [
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(239, 68, 68, 0.8)'
                        ],
                        borderColor: [
                            'rgb(34, 197, 94)',
                            'rgb(239, 68, 68)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // ë¡œë”© í‘œì‹œ
        function showLoading(show) {
            const loading = document.getElementById('searchLoading');
            if (show) {
                loading.classList.remove('hidden');
            } else {
                loading.classList.add('hidden');
            }
        }

        // íŒŒì¼ ì—…ë¡œë“œ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('border-blue-400', 'bg-blue-50');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('border-blue-400', 'bg-blue-50');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('border-blue-400', 'bg-blue-50');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                processFile(file);
            }
        }

        async function processFile(file) {
            if (file.size > 10 * 1024 * 1024) {
                alert('íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤. 10MB ì´í•˜ì˜ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            showLoading(true);

            try {
                let parsedData;

                if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                    const arrayBuffer = await file.arrayBuffer();
                    const workbook = XLSX.read(arrayBuffer);
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    parsedData = XLSX.utils.sheet_to_json(worksheet);
                } else if (file.name.endsWith('.csv')) {
                    const text = await file.text();
                    const result = Papa.parse(text, { 
                        header: true, 
                        dynamicTyping: true,
                        skipEmptyLines: true
                    });
                    parsedData = result.data;
                } else {
                    throw new Error('ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.');
                }

                // íŒŒì¼ ë°ì´í„° ë¶„ì„ ë¡œì§ (ê¸°ì¡´ê³¼ ë™ì¼)
                analyzeFileData(parsedData);
                showTab('analysis');
                
            } catch (error) {
                console.error('íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('âŒ ' + error.message);
            }

            showLoading(false);
        }

        function analyzeFileData(data) {
            // ê¸°ì¡´ íŒŒì¼ ë¶„ì„ ë¡œì§ê³¼ ë™ì¼
            // ... (ìƒëµ)
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            showTab('search');
            
            // ë“œë¡­ë‹¤ìš´ í¬ì»¤ìŠ¤ (ì•ˆì „í•˜ê²Œ)
            setTimeout(() => {
                const companySelect = document.getElementById('companySelect');
                if (companySelect) {
                    companySelect.focus();
                }
            }, 100);
            
            console.log('ğŸ¤– ìë™ ì¬ë¬´ì œí‘œ ë¶„ì„ê¸°ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!');
            console.log('ğŸ’¡ íŒ: ë“œë¡­ë‹¤ìš´ì—ì„œ ê¸°ì—…ì„ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”!');
        });

        // ì—ëŸ¬ í•¸ë“¤ë§
        window.addEventListener('error', function(e) {
            console.error('ì• í”Œë¦¬ì¼€ì´ì…˜ ì˜¤ë¥˜:', e.error);
        });

        // ë°˜ì‘í˜• ì²˜ë¦¬
        window.addEventListener('resize', function() {
            Object.values(charts).forEach(chart => {
                if (chart) chart.resize();
            });
        });
    </script>
</body>
</html>
